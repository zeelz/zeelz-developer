name: "Test Workflow"

on:
  pull_request:
    branches: github-action-ec2
    types:
      - opened
      - closed
  pull_request_target:
    branches: github-action-ec2
    types: synchronize

jobs:
  build:
    # strategy:
    #   matrix:
    #     os: [ubuntu-latest, windows-latest]
    # runs-on: ${{ matrix.os }}

    runs-on: ubuntu-latest
    env:
      MY_ENV_1: ${{secrets.MY_ENV_1}}
    steps:
      - name: "Create html for upload"
        run: |
          mkdir workflow-files
          echo "<h1>This is html created by a job and uploaded!</h1><p>Added this <pre> to trigger workflow</pre>" > workflow-files/workflow.html

      - name: create file
        run: |
          echo ${MY_ENV_1} > workflow-files/secret.pem

      - name: "Artifact upload"
        uses: actions/upload-artifact@v3
        with:
          name: artifacts
          path: workflow-files

  deploy:
    runs-on: ubuntu-latest
    if: github.event.pull_request.merged == true
    needs: build
    steps:
      - name: download file
        uses: actions/download-artifact@v3
        with:
          name: artifacts

      - name: use file
        run: |
          ls artifacts/workflow-files/secret.pem
          ls artifacts/secret.pem
